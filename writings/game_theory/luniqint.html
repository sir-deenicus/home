<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Least Unique Integer</title>
        <style type="text/css">
            body, html
            {
                margin: 0; padding: 0; height: 100%; overflow: hidden;
            }

            #content
            {
                position:absolute; left: 0; right: 0; bottom: 0; top: 0px; 
            }
        </style>
    </head>
    <body>
        <div id="content">
            <iframe width="100%" height="100%" frameborder="0" src="http://fable.io/repl.html#?astInput=false&babili=false&evaluate=false&lineWrap=false&presets=es2015%2Creact%2Cstage-2&code=open%20System%0D%0A%0D%0Alet%20random%20%3D%20new%20Random()%20%20%0D%0A%0D%0Alet%20joinpair%20f%20(a%2Cb)%20%3D%20f%20a%20b%0D%0A%0D%0Alet%20keepLeft%20f%20(x%2Cy)%20%3D%20x%2C%20f%20y%0D%0A%0D%0Alet%20flip%20f%20a%20b%20%3D%20f%20b%20a%0D%0A%0D%0Amodule%20Array%20%3D%0D%0A%20%20%20let%20indexed%20a%20%3D%20Array.mapi%20(fun%20i%20x%20-%3E%20(i%2Cx))%20a%0D%0A%20%20%20let%20selectColumn%20c%20a%20%3D%20%0D%0A%20%20%20%20%20%20%20Array.map%20(indexed%20%3E%3E%20Array.filter%20(fst%20%3E%3E%20(%3D)%20c)%20%3E%3E%20Array.map%20snd)%20a%20%20%0D%0A%20%20%20let%20inline%20normalizeWeights%20(a%3A%20('a%20*%20'b)%20%5B%5D)%20%3D%20%0D%0A%20%20%20%20%20%20let%20tot%20%3D%20Array.sumBy%20snd%20a%0D%0A%20%20%20%20%20%20Array.map%20(keepLeft%20(flip%20(%2F)%20tot))%20a%0D%0A%0D%0Amodule%20String%20%3D%20%0D%0A%20%20%20let%20pad%20padlen%20(s%3Astring)%20%3D%20s%20%2B%20String.replicate%20(max%200%20(padlen%20-%20s.Length))%20%22%20%22%0D%0A%20%20%20let%20inline%20toupper%20(str%3Astring)%20%3D%20str.ToUpper()%0D%0A%20%20%20%0D%0A%0D%0Alet%20inline%20joinToStringWith%20sep%20(s%3A'a%20seq)%20%3D%20String.Join(sep%2C%20s)%0D%0A%0D%0Alet%20buildTableRow%20(collens%3A_%5B%5D)%20(row%3Astring%5B%5D)%20%3D%0D%0A%20%20%20%20%20%20%20row%20%7C%3E%20Array.mapi%20(fun%20i%20s%20-%3E%20%20String.pad%20collens.%5Bi%5D%20s)%20%7C%3E%20joinToStringWith%20%22%20%7C%20%22%0D%0A%0D%0A%0D%0Alet%20makeTable%20newline%20headers%20title%20(table%3Astring%5B%5D%5B%5D)%20%3D%0D%0A%20%20%20%20%20%20%20let%20hlen%20%3D%20Array.map%20String.length%20headers%0D%0A%0D%0A%20%20%20%20%20%20%20let%20lens%20%3D%20table%20%7C%3E%20Array.map%20(Array.map%20(String.length))%0D%0A%0D%0A%20%20%20%20%20%20%20let%20longest%20%3D%20%5B%7Cfor%20c%20in%200..headers.Length%20-%201%20-%3E%20max%20hlen.%5Bc%5D%20(Array.selectColumn%20c%20lens%20%7C%3E%20Array.map%20Seq.head%20%7C%3E%20Array.max)%7C%5D%0D%0A%0D%0A%20%20%20%20%20%20%20let%20t0%20%3D%20table%20%7C%3E%20Array.map%20(buildTableRow%20longest)%20%7C%3E%20joinToStringWith%20newline%0D%0A%0D%0A%20%20%20%20%20%20%20let%20hrow%20%3D%20%5B%7Cheaders%3B%20%5B%7Cfor%20i%20in%200..headers.Length%20-%201%20-%3E%20String.replicate%20longest.%5Bi%5D%20%22-%22%7C%5D%7C%5D%20%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%3E%20Array.map%20(buildTableRow%20longest)%20%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%3E%20joinToStringWith%20newline%0D%0A%20%20%20%20%20%20%20String.Format(%22%7B0%7D%7B1%7D%7B1%7D%7B2%7D%7B1%7D%7B3%7D%22%2C%20(String.toupper%20title)%2C%20newline%2C%20hrow%2C%20t0)%0D%0A%0D%0A%0D%0Alet%20cdf%20p%20%3D%20%0D%0A%20%20%20%20p%20%7C%3E%20Array.fold%20(fun%20(total%2C%20list)%20v%20-%3E%20%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20cd%20%3D%20v%20%2B%20total%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cd%2C%20cd%3A%3Alist)%20(0.%2C%20%5B%5D)%20%0D%0A%20%20%20%20%20%20%7C%3E%20snd%20%0D%0A%20%20%20%20%20%20%7C%3E%20Array.ofList%20%0D%0A%0D%0Alet%20getDiscreteSampleFromCDF%20(pcdf%3Afloat%5B%5D)%20%3D%20%0D%0A%20%20%20%20let%20k%2C%20pcdlen%20%3D%20random.NextDouble()%20*%20pcdf.%5B0%5D%2C%20pcdf.Length%20-%201%0D%0A%20%20%20%20%0D%0A%20%20%20%20let%20rec%20cummProb%20idx%20%3D%20if%20k%20%3E%20pcdf.%5Bidx%5D%20then%20cummProb%20(idx%20-%201)%20else%20idx%0D%0A%20%20%20%20%0D%0A%20%20%20%20abs(cummProb%20pcdlen%20-%20pcdlen)%20%0D%0A%0D%0A%0D%0Alet%20discreteSample%20p%20%3D%20cdf%20p%20%7C%3E%20getDiscreteSampleFromCDF%20%20%0D%0A%20%20%0D%0A%0D%0Alet%20round%20(n%3Aint)%20(x%3Afloat)%20%3D%20Math.Round(x%2Cn)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0D%0A%20%0D%0Alet%20getStrategy%20(strategySum%3A_%5B%5D)%20regretSum%20%3D%0D%0A%20%20let%20strategy%20%20%20%20%20%20%20%20%20%3D%20Array.map%20(max%200.)%20%20regretSum%20%0D%0A%20%20let%20nSum%2C%20numactions%20%3D%20Array.sum%20strategy%2C%20strategy.Length%0D%0A%20%20%0D%0A%20%20let%20strategy'%20%3D%20%0D%0A%20%20%20%20%20%20if%20nSum%20%3C%3D%200.%20then%20%0D%0A%20%20%20%20%20%20%20%20%20%20%20Array.create%20numactions%20(1.%2Ffloat%20numactions)%20%0D%0A%20%20%20%20%20%20else%20Array.map%20(fun%20x%20-%3E%20x%2FnSum)%20strategy%0D%0A%20%20%0D%0A%20%20for%20a%20in%200..numactions%20-%201%20do%20strategySum.%5Ba%5D%20%3C-%20strategySum.%5Ba%5D%20%2B%20strategy'.%5Ba%5D%0D%0A%20%20strategy'%0D%0A%0D%0A%0D%0Alet%20getAvgStrategy%20strategySum%20%3D%20%20%0D%0A%20%20let%20nSum%2C%20numactions%20%3D%20Array.sum%20strategySum%2C%20strategySum.Length%20%20%20%20%20%20%20%20%20%20%20%0D%0A%20%20if%20%20nSum%20%3C%3D%200.%20then%20%0D%0A%20%20%20%20%20%20%20Array.create%20numactions%20(1.%2Ffloat%20numactions)%20%0D%0A%20%20else%20Array.map%20(fun%20x%20-%3E%20x%2FnSum)%20strategySum%0D%0A%20%20%20%0D%0A%0D%0Alet%20getAction%20(actions%3A_%5B%5D)%20strategy%20%3D%20actions.%5BdiscreteSample%20strategy%5D%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0D%0A%0D%0Alet%20inline%20printStrategy2%20title%20n%20strat%20%3D%20%0D%0A%20%20%20%20%20%20let%20rows%20%3D%20Array.map%20(fun%20(move%2Cp)%20-%3E%20%5B%7Cstring%20move%3B%20string(round%20n%20p)%7C%5D)%20strat%20%20%20%20%20%20%0D%0A%20%20%20%20%20%20let%20astable%20%3D%20makeTable%20%22%5Cn%22%20%5B%7C%22Move%22%3B%22Move%20Probability%22%7C%5D%20title%20rows%20%20%20%20%20%20%0D%0A%20%20%20%20%20%20%0D%0A%20%20%20%20%20%20printfn%20%22%5Cn%25s%22%20astable%0D%0A%0D%0A%0D%0Alet%20inline%20printStrategy%20title%20strat%20%3D%20printStrategy2%20title%203%20strat%20%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0D%0A%0D%0A%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%20%20%20%0D%0A%0D%0Alet%20rateOutcomeForFirst%20(a%2Cb%2Cc)%20%3D%20%0D%0A%20%20%20%20if%20a%20%3D%20b%20%26%26%20a%20%3D%20c%20%26%26%20b%20%3D%20c%20then%200.%20%0D%0A%20%20%20%20elif%20a%20%3C%20b%20%26%26%20a%20%3C%20c%20then%202.%20%0D%0A%20%20%20%20elif%20a%20%3C%3E%20b%20%26%26%20b%20%3D%20c%20then%202.%20%0D%0A%20%20%20%20else%20-1.%0D%0A%0D%0Alet%20trainstep%20iters%20util%20actions%20stratsList%20%20%3D%20%20%20%20%0D%0A%20%20%20%20for%20_%20in%200..iters%20-%201%20do%20%0D%0A%20%20%20%20%20%20%20%20let%20strats%20%3D%20Array.map%20(fun%20(s%2Cr)%20-%3E%20getStrategy%20s%20r)%20stratsList%0D%0A%20%20%20%20%20%20%20%20let%20acts%20%20%20%3D%20Array.map%20(getAction%20actions)%20strats%0D%0A%0D%0A%20%20%20%20%20%20%20%20let%20heroutil%20%20%20%3D%20util%20(acts.%5B0%5D%2Cacts.%5B1%5D%2Cacts.%5B2%5D)%0D%0A%20%20%20%20%20%20%20%20let%20otherutil%20%20%3D%20util%20(acts.%5B1%5D%2Cacts.%5B0%5D%2Cacts.%5B2%5D)%0D%0A%20%20%20%20%20%20%20%20let%20otherutil2%20%3D%20util%20(acts.%5B2%5D%2Cacts.%5B0%5D%2Cacts.%5B1%5D)%0D%0A%20%20%20%20%0D%0A%20%20%20%20%20%20%20%20let%20utils%20%3D%20%5B%7Cheroutil%3Botherutil%3Botherutil2%7C%5D%0D%0A%20%20%20%20%20%20%20%20let%20jointRegretSum%20%3D%20Array.map%20snd%20stratsList%0D%0A%0D%0A%20%20%20%20%20%20%20%20Array.iteri%20(fun%20a%20action%20-%3E%20%20%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20altutil%3Afloat%20%3D%20%20util%20(action%2Cacts.%5B1%5D%2Cacts.%5B2%5D)%20%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20altutil2%20%3D%20util%20(action%2Cacts.%5B0%5D%2Cacts.%5B2%5D)%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20altutil3%20%3D%20util%20(action%2Cacts.%5B0%5D%2Cacts.%5B1%5D)%0D%0A%20%20%20%20%20%20%20%20%20%20%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20altutils%20%3D%20%5B%7Caltutil%3Baltutil2%3Baltutil3%7C%5D%0D%0A%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20i%20in%200..2%20do%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20jointRegretSum.%5Bi%5D.%5Ba%5D%20%20%3C-%20jointRegretSum.%5Bi%5D.%5Ba%5D%20%2B%20(altutils.%5Bi%5D%20-%20utils.%5Bi%5D))%20actions%0D%0A%0D%0Alet%20actions%20%3D%20%5B%7C0..5%7C%5D%0D%0A%0D%0Alet%20createStrats%20%20%3D%20Array.init%20%20%203%20(fun%20_%20-%3E%20Array.create%20actions.Length%200.%2C%20Array.create%20actions.Length%200.)%0D%0Alet%20createStrats2%20%3D%20Array.create%203%20(Array.create%20actions.Length%200.%2C%20Array.create%20actions.Length%200.)%0D%0A%0D%0Atrainstep%2050_000%20rateOutcomeForFirst%20actions%20createStrats%0D%0Atrainstep%2020_000%20rateOutcomeForFirst%20actions%20createStrats2%0D%0A%0D%0Alet%20naiveGuesser%20%3D%20%5B%7C0.7%3B0.15%3B0.1%3B0.0%3B0.0%3B0.05%7C%5D%20%20%20%20%0D%0A%0D%0Aprintfn%20%22%5CnAttempt%20at%20Nash%22%0D%0AArray.iter%20(fun%20(s%2C_)%20-%3E%20Array.zip%20actions%20(getAvgStrategy%20s)%20%7C%3E%20printStrategy%20%22Guess%20Strategy%22)%20createStrats2%0D%0A%0D%0Aprintfn%20%22%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%22%0D%0Aprintfn%20%22%5CnRegret%20Matching%20on%20each%20other%60s%20actions%22%0D%0AArray.iter%20(fun%20(s%2C_)%20-%3E%20Array.zip%20actions%20(getAvgStrategy%20s)%20%7C%3E%20printStrategy%20%22Guess%20Strategy%22)%20createStrats%0D%0A%0D%0A%0D%0Alet%20arrayToTriple%20(x%3A_%5B%5D)%20%3D%20x.%5B0%5D%2Cx.%5B1%5D%2Cx.%5B2%5D%0D%0A%0D%0Alet%20swap3b%20(a%2Cb%2Cc)%20%3D%20b%2Ca%2Cc%0D%0Alet%20swap3c%20(a%2Cb%2Cc)%20%3D%20c%2Ca%2Cb%0D%0A%0D%0Alet%20runRound%20()%20%3D%20createStrats2%20%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%3E%20Array.mapi%20(fun%20i%20(s%2C_)%20-%3E%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20i%20%3E%200%20then%20discreteSample%20naiveGuesser%20%2F%2F%20%3C%3D%3D%20CHANGE%20the%200%20to%20a%201%20or%203%20or%202%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20(actions%2C%20(getAvgStrategy%20s))%20%7C%7C%3E%20getAction%20)%20%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%3E%20arrayToTriple%20%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%3E%20id%20%20%2F%2F%20**%20%3C%3D%3D%20CHANGE%20to%20swap3b**%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%3E%20rateOutcomeForFirst%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0D%0A%5B%7Cfor%20_%20in%200..999%20-%3E%20runRound()%7C%5D%20%0D%0A%20%7C%3E%20Array.groupBy%20id%20%0D%0A%20%7C%3E%20Array.map%20(keepLeft%20(Array.length%3E%3Efloat))%20%0D%0A%20%7C%3E%20Array.normalizeWeights%0D%0A%20%7C%3E%20Array.sumBy%20(joinpair%20(*))%20%0D%0A%20%7C%3E%20round%202%20%20%0D%0A%20%7C%3E%20printfn%20%22%5Cn%3D%3D%3D%3D%3D%3D%3D%3D%3D%5CnWinrate%20of%20Strategy%201%3A%20%25A%22%0D%0A%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%0D%0A%0D%0A" />
        </div>
    </body>
</html>